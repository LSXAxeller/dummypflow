<shadui:Window
    x:Class="ProseFlow.UI.Views.MainWindow"
    xmlns="https://github.com/avaloniaui"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:shadui="clr-namespace:ShadUI;assembly=ShadUI"
    xmlns:vm="using:ProseFlow.UI.ViewModels"
    x:DataType="vm:MainViewModel"
    mc:Ignorable="d"
    d:DesignWidth="1920"
    d:DesignHeight="1080"

    Title="ProseFlow"
    Icon="/Assets/avalonia-logo.ico"
    Width="1920" Height="1080"
    MinWidth="800" MinHeight="700"
    WindowStartupLocation="CenterScreen"

    TitleFontWeight="SemiBold"
    SaveWindowState="True">

    <shadui:Window.LogoContent>
        <PathIcon
            Width="14"
            Height="14"
            Margin="8,8,0,8"
            Data="{x:Static shadui:Icons.Logo}" />
    </shadui:Window.LogoContent>

    <shadui:Window.Hosts>
        <shadui:DialogHost Manager="{Binding DialogManager}"
                           Owner="{Binding RelativeSource={RelativeSource AncestorType=shadui:Window}}" />
    </shadui:Window.Hosts>

    <!-- Theme switcher -->
    <shadui:Window.RightWindowTitleBarContent>
        <StackPanel Orientation="Horizontal" Spacing="8">
            <Button
                Width="30"
                Height="30"
                Background="{DynamicResource SidebarBackgroundColor}"
                Command="{Binding SwitchThemeCommand}"
                CornerRadius="{DynamicResource MdCornerRadius}"
                ToolTip.Tip="Switch Theme">
                <TextBlock Classes="LucideIcon" Text="" />
            </Button>
        </StackPanel>
    </shadui:Window.RightWindowTitleBarContent>

    <Panel>
        <Grid ColumnDefinitions="Auto, *">
            <!-- Collapsible Sidebar for Navigation -->
            <shadui:Sidebar
                Grid.Column="0"
                Width="220"
                MinWidth="60"
                BorderBrush="{DynamicResource BorderColor30}"
                BorderThickness="0,0,1,0"
                Expanded="{Binding #Toggler.IsChecked}">

                <shadui:Sidebar.Header>
                    <!-- App Title -->
                    <StackPanel Spacing="4"
                                Margin="8,10"
                                Orientation="Horizontal"
                                HorizontalAlignment="Center"
                                IsVisible="{Binding #Toggler.IsChecked}">
                        <TextBlock
                            Classes="h3"
                            Text="Prose"
                            FontWeight="SemiBold"
                            FontFamily="{StaticResource ManropeFont}" />
                        <TextBlock
                            Classes="h3"
                            Text="Flow"
                            FontWeight="Bold"
                            Foreground="{DynamicResource PrimaryColor}"
                            FontFamily="{StaticResource ManropeFont}" />
                    </StackPanel>
                </shadui:Sidebar.Header>

                <!-- Navigation Items -->
                <ItemsControl ItemsSource="{Binding PageViewModels}" Margin="0,16,0,0">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <shadui:SidebarItem
                                Content="{Binding Title}"
                                IsChecked="{Binding IsSelected}"
                                Command="{Binding $parent[Window].((vm:MainViewModel)DataContext).NavigateCommand, FallbackValue={x:Null}}"
                                CommandParameter="{Binding .}">
                                <shadui:SidebarItem.Icon>
                                    <Viewbox>
                                        <TextBlock Classes="LucideIcon" Text="{Binding Icon}" />
                                    </Viewbox>
                                </shadui:SidebarItem.Icon>
                            </shadui:SidebarItem>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>

                <shadui:Sidebar.Footer>
                    <!-- Toggle button to expand/collapse the sidebar -->
                    <ToggleButton
                        Name="Toggler"
                        HorizontalAlignment="Left"
                        Width="32"
                        Height="32"
                        Padding="8"
                        Margin="16,0,0,16"
                        CornerRadius="{DynamicResource LgCornerRadius}"
                        Theme="{DynamicResource SideTogglerTheme}">
                        <Viewbox>
                            <TextBlock Classes="LucideIcon" Text="" />
                        </Viewbox>
                    </ToggleButton>
                </shadui:Sidebar.Footer>
            </shadui:Sidebar>

            <!-- Main Content Area with smooth transitions -->
            <TransitioningContentControl
                Grid.Column="1"
                Content="{Binding CurrentPage}" />
        </Grid>

        <!-- Toast Notification Host -->
        <shadui:ToastHost Manager="{Binding ToastManager}" />
    </Panel>
</shadui:Window>